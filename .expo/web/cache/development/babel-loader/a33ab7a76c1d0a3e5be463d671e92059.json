{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/objectSpread\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport NativeInterface from \"./nativeInterface\";\nimport InternetReachability from \"./internetReachability\";\nimport * as PrivateTypes from \"./privateTypes\";\n\nvar State = function State(configuration) {\n  var _this = this;\n\n  _classCallCheck(this, State);\n\n  this._nativeEventSubscription = null;\n  this._subscriptions = new Set();\n  this._latestState = null;\n\n  this._handleNativeStateUpdate = function (state) {\n    _this._internetReachability.update(state);\n\n    var convertedState = _this._convertState(state);\n\n    _this._latestState = convertedState;\n\n    _this._subscriptions.forEach(function (handler) {\n      return handler(convertedState);\n    });\n  };\n\n  this._handleInternetReachabilityUpdate = function (isInternetReachable) {\n    if (!_this._latestState) {\n      return;\n    }\n\n    var nextState = _objectSpread({}, _this._latestState, {\n      isInternetReachable: isInternetReachable\n    });\n\n    _this._latestState = nextState;\n\n    _this._subscriptions.forEach(function (handler) {\n      return handler(nextState);\n    });\n  };\n\n  this._fetchCurrentState = function _callee(requestedInterface) {\n    var state, convertedState;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(NativeInterface.getCurrentState(requestedInterface));\n\n          case 2:\n            state = _context.sent;\n\n            _this._internetReachability.update(state);\n\n            convertedState = _this._convertState(state);\n\n            if (!requestedInterface) {\n              _this._latestState = convertedState;\n            }\n\n            return _context.abrupt(\"return\", convertedState);\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, this);\n  };\n\n  this._convertState = function (input) {\n    if (typeof input.isInternetReachable === 'boolean') {\n      return input;\n    } else {\n      return _objectSpread({}, input, {\n        isInternetReachable: _this._internetReachability.currentState()\n      });\n    }\n  };\n\n  this.latest = function (requestedInterface) {\n    if (requestedInterface) {\n      return _this._fetchCurrentState(requestedInterface);\n    } else if (_this._latestState) {\n      return Promise.resolve(_this._latestState);\n    } else {\n      return _this._fetchCurrentState();\n    }\n  };\n\n  this.add = function (handler) {\n    _this._subscriptions.add(handler);\n\n    if (_this._latestState) {\n      handler(_this._latestState);\n    } else {\n      _this.latest().then(handler);\n    }\n  };\n\n  this.remove = function (handler) {\n    _this._subscriptions.delete(handler);\n  };\n\n  this.tearDown = function () {\n    if (_this._internetReachability) {\n      _this._internetReachability.tearDown();\n    }\n\n    if (_this._nativeEventSubscription) {\n      _this._nativeEventSubscription.remove();\n    }\n\n    _this._subscriptions.clear();\n  };\n\n  this._internetReachability = new InternetReachability(configuration, this._handleInternetReachabilityUpdate);\n  this._nativeEventSubscription = NativeInterface.eventEmitter.addListener(PrivateTypes.DEVICE_CONNECTIVITY_EVENT, this._handleNativeStateUpdate);\n\n  this._fetchCurrentState();\n};\n\nexport { State as default };","map":{"version":3,"sources":["state.ts"],"names":["State","_nativeEventSubscription","_subscriptions","_latestState","NativeInterface","PrivateTypes","convertedState","handler","nextState","isInternetReachable","state","input","Promise"],"mappings":";;;AAUA,OAAA,eAAA;AACA,OAAA,oBAAA;AAEA,OAAO,KAAP,YAAA;;AAEqBA,IAAAA,K,GAMnB,SAAA,KAAA,CAAA,aAAA,EAAuD;AAAA,MAAA,KAAA,GAAA,IAAA;;AAAA,EAAA,eAAA,CAAA,IAAA,EAAA,KAAA,CAAA;;AAAA,OAL/CC,wBAK+C,GALY,IAKZ;AAAA,OAJ/CC,cAI+C,GAJ9B,IAAA,GAAA,EAI8B;AAAA,OAH/CC,YAG+C,GAHL,IAGK;;AAAA,OAAA,wBAAA,GAiBpB,UAAA,KAAA,EAExB;AAET,IAAA,KAAI,CAAJ,qBAAA,CAAA,MAAA,CAAA,KAAA;;AAGA,QAAMG,cAAc,GAAG,KAAI,CAAJ,aAAA,CAAvB,KAAuB,CAAvB;;AAGA,IAAA,KAAI,CAAJ,YAAA,GAAA,cAAA;;AACA,IAAA,KAAI,CAAJ,cAAA,CAAA,OAAA,CAA4B,UAAA,OAAA,EAAA;AAAA,aAAmBC,OAAO,CAA1B,cAA0B,CAA1B;AAA5B,KAAA;AA5BqD,GAAA;;AAAA,OAAA,iCAAA,GA+BX,UAAA,mBAAA,EAEjC;AACT,QAAI,CAAC,KAAI,CAAT,YAAA,EAAwB;AACtB;AAGF;;AAAA,QAAMC,SAAS,GAAA,aAAA,CAAA,EAAA,EACV,KAAI,CADM,YAAA,EAAA;AAEbC,MAAAA,mBAAmB,EAFrB;AAAe,KAAA,CAAf;;AAIA,IAAA,KAAI,CAAJ,YAAA,GAAA,SAAA;;AACA,IAAA,KAAI,CAAJ,cAAA,CAAA,OAAA,CAA4B,UAAA,OAAA,EAAA;AAAA,aAAmBF,OAAO,CAA1B,SAA0B,CAA1B;AAA5B,KAAA;AA3CqD,GAAA;;AAAA,OAAA,kBAAA,GA8C1B,SAAA,OAAA,CAAA,kBAAA,EAAA;AAAA,QAAA,KAAA,EAAA,cAAA;AAAA,WAAA,mBAAA,CAAA,KAAA,CAAA,SAAA,QAAA,CAAA,QAAA,EAAA;AAAA,aAAA,CAAA,EAAA;AAAA,gBAAA,QAAA,CAAA,IAAA,GAAA,QAAA,CAAA,IAAA;AAAA,eAAA,CAAA;AAAA,YAAA,QAAA,CAAA,IAAA,GAAA,CAAA;AAAA,mBAAA,mBAAA,CAAA,KAAA,CAGPH,eAAe,CAAfA,eAAAA,CAHO,kBAGPA,CAHO,CAAA;;AAAA,eAAA,CAAA;AAGrBM,YAAAA,KAHqB,GAAA,QAAA,CAAA,IAGrBA;;AAGN,YAAA,KAAI,CAAJ,qBAAA,CAAA,MAAA,CAAA,KAAA;;AAEMJ,YAAAA,cARqB,GAQJ,KAAI,CAAJ,aAAA,CARI,KAQJ,CAAjBA;;AACN,gBAAI,CAAJ,kBAAA,EAAyB;AACvB,cAAA,KAAI,CAAJ,YAAA,GAAA,cAAA;AAVyB;;AAAA,mBAAA,QAAA,CAAA,MAAA,CAAA,QAAA,EAAA,cAAA,CAAA;;AAAA,eAAA,CAAA;AAAA,eAAA,KAAA;AAAA,mBAAA,QAAA,CAAA,IAAA,EAAA;AAAA;AAAA;AAAA,KAAA,EAAA,IAAA,EAAA,IAAA,CAAA;AA9C0B,GAAA;;AAAA,OAAA,aAAA,GA8D/B,UAAA,KAAA,EAEC;AACvB,QAAI,OAAOK,KAAK,CAAZ,mBAAA,KAAJ,SAAA,EAAoD;AAClD,aAAA,KAAA;AADF,KAAA,MAEO;AACL,aAAA,aAAA,CAAA,EAAA,EAAA,KAAA,EAAA;AAEEF,QAAAA,mBAAmB,EAAE,KAAI,CAAJ,qBAAA,CAFvB,YAEuB;AAFvB,OAAA,CAAA;AAKH;AAzEsD,GAAA;;AAAA,OAAA,MAAA,GA2EvC,UAAA,kBAAA,EAEkB;AAChC,QAAA,kBAAA,EAAwB;AACtB,aAAO,KAAI,CAAJ,kBAAA,CAAP,kBAAO,CAAP;AADF,KAAA,MAEO,IAAI,KAAI,CAAR,YAAA,EAAuB;AAC5B,aAAOG,OAAO,CAAPA,OAAAA,CAAgB,KAAI,CAA3B,YAAOA,CAAP;AADK,KAAA,MAEA;AACL,aAAO,KAAI,CAAX,kBAAO,EAAP;AAEH;AArFsD,GAAA;;AAAA,OAAA,GAAA,GAuF1C,UAAA,OAAA,EAA+C;AAE1D,IAAA,KAAI,CAAJ,cAAA,CAAA,GAAA,CAAA,OAAA;;AAGA,QAAI,KAAI,CAAR,YAAA,EAAuB;AACrBL,MAAAA,OAAO,CAAC,KAAI,CAAZA,YAAO,CAAPA;AADF,KAAA,MAEO;AACL,MAAA,KAAI,CAAJ,MAAA,GAAA,IAAA,CAAA,OAAA;AAEH;AAjGsD,GAAA;;AAAA,OAAA,MAAA,GAmGvC,UAAA,OAAA,EAA+C;AAC7D,IAAA,KAAI,CAAJ,cAAA,CAAA,MAAA,CAAA,OAAA;AApGqD,GAAA;;AAAA,OAAA,QAAA,GAuGrC,YAAY;AAC5B,QAAI,KAAI,CAAR,qBAAA,EAAgC;AAC9B,MAAA,KAAI,CAAJ,qBAAA,CAAA,QAAA;AAGF;;AAAA,QAAI,KAAI,CAAR,wBAAA,EAAmC;AACjC,MAAA,KAAI,CAAJ,wBAAA,CAAA,MAAA;AAGF;;AAAA,IAAA,KAAI,CAAJ,cAAA,CAAA,KAAA;AAhHqD,GAAA;;AAErD,OAAA,qBAAA,GAA6B,IAAA,oBAAA,CAAA,aAAA,EAE3B,KAFF,iCAA6B,CAA7B;AAMA,OAAA,wBAAA,GAAgCH,eAAe,CAAfA,YAAAA,CAAAA,WAAAA,CAC9BC,YAAY,CADkBD,yBAAAA,EAE9B,KAFF,wBAAgCA,CAAhC;;AAMA,OAAA,kBAAA;CApBiBJ;;SAAAA,K","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n */\n\nimport {NativeEventSubscription} from 'react-native';\nimport NativeInterface from './nativeInterface';\nimport InternetReachability from './internetReachability';\nimport * as Types from './types';\nimport * as PrivateTypes from './privateTypes';\n\nexport default class State {\n  private _nativeEventSubscription: NativeEventSubscription | null = null;\n  private _subscriptions = new Set<Types.NetInfoChangeHandler>();\n  private _latestState: Types.NetInfoState | null = null;\n  private _internetReachability: InternetReachability;\n\n  constructor(configuration: Types.NetInfoConfiguration) {\n    // Add the listener to the internet connectivity events\n    this._internetReachability = new InternetReachability(\n      configuration,\n      this._handleInternetReachabilityUpdate,\n    );\n\n    // Add the subscription to the native events\n    this._nativeEventSubscription = NativeInterface.eventEmitter.addListener(\n      PrivateTypes.DEVICE_CONNECTIVITY_EVENT,\n      this._handleNativeStateUpdate,\n    );\n\n    // Fetch the current state from the native module\n    this._fetchCurrentState();\n  }\n\n  private _handleNativeStateUpdate = (\n    state: PrivateTypes.NetInfoNativeModuleState,\n  ): void => {\n    // Update the internet reachability module\n    this._internetReachability.update(state);\n\n    // Convert the state from native to JS shape\n    const convertedState = this._convertState(state);\n\n    // Update the listeners\n    this._latestState = convertedState;\n    this._subscriptions.forEach((handler): void => handler(convertedState));\n  };\n\n  private _handleInternetReachabilityUpdate = (\n    isInternetReachable: boolean | null | undefined,\n  ): void => {\n    if (!this._latestState) {\n      return;\n    }\n\n    const nextState = {\n      ...this._latestState,\n      isInternetReachable,\n    } as Types.NetInfoState;\n    this._latestState = nextState;\n    this._subscriptions.forEach((handler): void => handler(nextState));\n  };\n\n  private _fetchCurrentState = async (\n    requestedInterface?: string,\n  ): Promise<Types.NetInfoState> => {\n    const state = await NativeInterface.getCurrentState(requestedInterface);\n\n    // Update the internet reachability module\n    this._internetReachability.update(state);\n    // Convert and store the new state\n    const convertedState = this._convertState(state);\n    if (!requestedInterface) {\n      this._latestState = convertedState;\n    }\n\n    return convertedState;\n  };\n\n  private _convertState = (\n    input: PrivateTypes.NetInfoNativeModuleState,\n  ): Types.NetInfoState => {\n    if (typeof input.isInternetReachable === 'boolean') {\n      return input as Types.NetInfoState;\n    } else {\n      return {\n        ...input,\n        isInternetReachable: this._internetReachability.currentState(),\n      } as Types.NetInfoState;\n    }\n  };\n\n  public latest = (\n    requestedInterface?: string,\n  ): Promise<Types.NetInfoState> => {\n    if (requestedInterface) {\n      return this._fetchCurrentState(requestedInterface);\n    } else if (this._latestState) {\n      return Promise.resolve(this._latestState);\n    } else {\n      return this._fetchCurrentState();\n    }\n  };\n\n  public add = (handler: Types.NetInfoChangeHandler): void => {\n    // Add the subscription handler to our set\n    this._subscriptions.add(handler);\n\n    // Send it the latest data we have\n    if (this._latestState) {\n      handler(this._latestState);\n    } else {\n      this.latest().then(handler);\n    }\n  };\n\n  public remove = (handler: Types.NetInfoChangeHandler): void => {\n    this._subscriptions.delete(handler);\n  };\n\n  public tearDown = (): void => {\n    if (this._internetReachability) {\n      this._internetReachability.tearDown();\n    }\n\n    if (this._nativeEventSubscription) {\n      this._nativeEventSubscription.remove();\n    }\n\n    this._subscriptions.clear();\n  };\n}\n"]},"metadata":{},"sourceType":"module"}